alias reload="source $HOME/.zshrc"

# Cargo env
if [[ -f "$HOME/.cargo/env" ]]; then
    source "$HOME/.cargo/env"
fi

# Homebrew env
if [[ -f /opt/homebrew/bin/brew ]]; then
    eval "$(/opt/homebrew/bin/brew shellenv)"
    export ZPLUG_HOME="/opt/homebrew/opt/zplug"
    if [[ -d /opt/homebrew/opt/tpm/share/tpm && ! -d ~/.tmux/plugins/tpm ]]; then
        mkdir -p ~/.tmux/plugins
        ln -s /opt/homebrew/opt/tpm/share/tpm ~/.tmux/plugins/tpm
    fi
fi

# Neovim
if [[ -d /usr/local/nvim/bin ]]; then
    export EDITOR=nvim
    export PATH="${PATH:+${PATH}:}/usr/local/nvim/bin"
fi

#
"$HOME/.files/shell/install.py"

# Shell Completions
autoload -Uz compinit && compinit
if command -v just &>/dev/null; then
    eval "$(just --completions=zsh)"
fi

# Starship
# workaround a starship bug on MacOS https://github.com/starship/starship/issues/3418#issuecomment-2477375663
if [[ "${widgets[zle - keymap - select]#user:}" == "starship_zle-keymap-select" ||
    "${widgets[zle - keymap - select]#user:}" == "starship_zle-keymap-select-wrapped" ]]; then
    zle -N zle-keymap-select ""
fi
eval "$(starship init zsh)"
# Updating Clock
TMOUT=1
TRAPALRM() {
    case "$WIDGET" in
    *fzf* | expand-or-complete | self-insert | up-line-or-beginning-search | down-line-or-beginning-search | backward-delete-char | .history-incremental-search-backward | .history-incremental-search-forward)
        :
        ;;

    *)
        zle reset-prompt
        ;;
    esac
}

# Fzf (note: initialized in zplug, after zsh-vi-mode)
if [[ -f "$HOME/.fzf/bin/fzf" ]]; then
    export PATH="${PATH:+${PATH}:}/$HOME/.fzf/bin"
fi
export FZF_ALT_C_COMMAND=""
export FZF_CTRL_T_COMMAND=""

# Set Up Plugins
source ~/.files/shell/zsh/zplug

# remaining aliases and command specific stuff
source ~/.files/shell/aliases

# zoxide wants to be at the end
eval "$(zoxide init zsh)"
